<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do Not Sell or Share My Personal Information - MartiDeals</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="privacy-container">
        <h1>Do Not Sell or Share My Personal Information</h1>
        
        <div class="intro-text">
            <p>You may opt out of the "sale" of your personal information at any time. Once you submit your request, we will stop sharing your information and device identifiers with third parties. This opt-out works only for the device and browser you're using right now. If you use another computer, phone, or browser, you'll need to opt out again there too.</p>
        </div>

        <div class="opt-out-form-container">
            <form id="optOutForm" class="opt-out-form">
                <div class="form-group">
                    <button type="submit" class="btn-primary submit-btn">Submit Request</button>
                </div>
            </form>
        </div>

        <div id="confirmationMessage" class="confirmation-message" style="display: none;">
            <div class="confirmation-content">
                <h3>Request Received</h3>
                <p>Your request has been received. We will process your opt-out within 14 days and stop sharing your information.</p>
            </div>
        </div>

        <div class="additional-info">
            <h2>What This Means</h2>
            <p>When you submit this request, we will:</p>
            <ul>
                <li>Stop sharing your personal information with third parties for advertising purposes</li>
                <li>Stop sharing your device identifiers with advertising networks</li>
                <li>Process your request within 14 business days</li>
                <li>Apply the opt-out to this specific device and browser</li>
            </ul>

            <h2>Important Notes</h2>
            <ul>
                <li>This opt-out is device and browser specific</li>
                <li>You'll need to submit separate requests for each device/browser you use</li>
                <li>We may still collect information for essential business purposes</li>
                <li>This does not affect information sharing required by law</li>
            </ul>

            <h2>Questions?</h2>
            <p>If you have questions about this process or your privacy rights, please contact us at privacy@roundforest.com or visit our <a href="/privacy-policy">Privacy Policy</a> and <a href="/ccpa-privacy-rights">CCPA Notice</a>.</p>
        </div>
    </div>

    <script>
        // Function to delete all third-party cookies
        function deleteThirdPartyCookies() {
            // Get all cookies
            const cookies = document.cookie.split(';');
            
            // Common third-party cookie prefixes/names to delete
            const thirdPartyPrefixes = [
                '_ga', '_gid', '_gat', '_gtag', '_gcl', // Google Analytics/Ads
                '_fbp', '_fbc', 'fr', // Facebook
                '__utma', '__utmb', '__utmc', '__utmt', '__utmz', // Google Analytics (legacy)
                '_hjid', '_hjIncludedInSessionSample', // Hotjar
                'IDE', 'DSID', 'FLC', 'AID', 'TAID', // DoubleClick
                '__cfduid', // Cloudflare
                '_tt_enable_cookie', 'tt_appInfo', 'tt_sessionId', // TikTok
                'personalization_id', 'guest_id', // Twitter
                'bcookie', 'lidc', 'UserMatchHistory', // LinkedIn
                'uuid2', 'anj', 'sess', // AppNexus
                'tuuid', 'tuuid_lu', // The Trade Desk
                'CMID', 'CMPS', 'rum', // Casale Media
                'rpb', 'rpx', // RunAds
                'mc', 'ms', // Quantcast
                'UID', 'UIDR', // Scorecardresearch
                'ANID', 'CONSENT', 'NID', '1P_JAR', 'APISID', 'HSID', 'SAPISID', 'SID', 'SIDCC', 'SSID', // Google
                'mp_', 'mixpanel', '__mp_opt_in_out' // Mixpanel
            ];
            
            cookies.forEach(function(cookie) {
                const cookieName = cookie.split('=')[0].trim();
                
                // Check if it's a third-party cookie
                const isThirdParty = thirdPartyPrefixes.some(prefix => 
                    cookieName.startsWith(prefix) || cookieName.includes(prefix)
                );
                
                if (isThirdParty) {
                    // Delete cookie for current domain
                    document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                    document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + window.location.hostname + ';';
                    document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.' + window.location.hostname + ';';
                    
                    // Try to delete for parent domains
                    const domainParts = window.location.hostname.split('.');
                    for (let i = 0; i < domainParts.length - 1; i++) {
                        const parentDomain = '.' + domainParts.slice(i).join('.');
                        document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + parentDomain + ';';
                    }
                    
                    console.log('Deleted third-party cookie:', cookieName);
                }
            });
            
            // Clear localStorage items related to tracking
            const trackingKeys = [
                '_ga', '_gid', '_gat', '_gtag',
                '_fbp', '_fbc',
                '__utma', '__utmb', '__utmc', '__utmt', '__utmz',
                '_hjid', '_hjIncludedInSessionSample',
                'mp_', 'mixpanel', '__mp_opt_in_out', 'mp_super_properties' // Mixpanel
            ];
            
            trackingKeys.forEach(key => {
                localStorage.removeItem(key);
                sessionStorage.removeItem(key);
            });
            
            // Clear IndexedDB data (if any tracking scripts use it)
            if ('indexedDB' in window) {
                try {
                    indexedDB.databases().then(databases => {
                        databases.forEach(db => {
                            if (db.name && (db.name.includes('google') || db.name.includes('facebook') || db.name.includes('analytics'))) {
                                indexedDB.deleteDatabase(db.name);
                                console.log('Deleted IndexedDB:', db.name);
                            }
                        });
                    });
                } catch (e) {
                    console.log('Could not clear IndexedDB:', e);
                }
            }
        }
        
        // Function to disable future tracking
        function disableFutureTracking() {
            // Set global opt-out flags that tracking scripts check
            window['ga-disable-GA_MEASUREMENT_ID'] = true;
            window.gtag = function() { console.log('Google Analytics disabled due to opt-out'); };
            window.fbq = function() { console.log('Facebook Pixel disabled due to opt-out'); };
            
            // Disable Mixpanel tracking
            if (typeof mixpanel !== 'undefined') {
                mixpanel.opt_out_tracking();
                console.log('Mixpanel tracking disabled due to opt-out');
            }
            
            // Override Mixpanel functions to prevent future tracking
            window.mixpanel = {
                track: function() { console.log('Mixpanel tracking disabled due to opt-out'); },
                identify: function() { console.log('Mixpanel identify disabled due to opt-out'); },
                people: {
                    set: function() { console.log('Mixpanel people.set disabled due to opt-out'); },
                    increment: function() { console.log('Mixpanel people.increment disabled due to opt-out'); }
                },
                register: function() { console.log('Mixpanel register disabled due to opt-out'); },
                opt_out_tracking: function() { return true; },
                has_opted_out_tracking: function() { return true; }
            };
            
            // Set Do Not Track
            if (navigator.doNotTrack !== undefined) {
                navigator.doNotTrack = "1";
            }
            
            // Disable Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'denied',
                    'ad_storage': 'denied',
                    'ad_user_data': 'denied',
                    'ad_personalization': 'denied'
                });
            }
        }

        document.getElementById('optOutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Delete all third-party cookies immediately
            deleteThirdPartyCookies();
            
            // Disable future tracking
            disableFutureTracking();
            
            // Set opt-out flag in localStorage
            localStorage.setItem('doNotSell', 'true');
            localStorage.setItem('optOutDate', new Date().toISOString());
            localStorage.setItem('cookiesDeleted', 'true');
            
            // Hide form and show confirmation
            document.querySelector('.opt-out-form-container').style.display = 'none';
            document.getElementById('confirmationMessage').style.display = 'block';
            
            // Update confirmation message to mention cookie deletion
            const confirmationContent = document.querySelector('.confirmation-content p');
            confirmationContent.innerHTML = 'Your request has been received. We have immediately deleted all third-party tracking cookies and will process your opt-out within 14 days to stop sharing your information.';
            
            // Optional: Send request to server
            // This would typically involve an API call to record the opt-out request
            fetch('/api/opt-out', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    optOut: true,
                    cookiesDeleted: true
                })
            }).catch(function(error) {
                console.log('Opt-out request logged locally');
            });
            
            console.log('✅ Opt-out complete: Third-party cookies deleted and tracking disabled');
        });

        // Check if user has already opted out
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('doNotSell') === 'true') {
                document.querySelector('.opt-out-form-container').style.display = 'none';
                document.getElementById('confirmationMessage').style.display = 'block';
                
                // If they've already opted out, make sure tracking is still disabled
                disableFutureTracking();
                
                // Update confirmation message for returning users
                const confirmationContent = document.querySelector('.confirmation-content p');
                const optOutDate = localStorage.getItem('optOutDate');
                if (optOutDate) {
                    const date = new Date(optOutDate).toLocaleDateString();
                    confirmationContent.innerHTML = `You opted out on ${date}. Third-party tracking cookies have been deleted and we have stopped sharing your information.`;
                }
            }
        });
    </script>

    <style>
        .privacy-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }

        .intro-text {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #007bff;
        }

        .opt-out-form-container {
            text-align: center;
            margin: 40px 0;
        }

        .submit-btn {
            background-color: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #0056b3;
        }

        .confirmation-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .confirmation-content h3 {
            color: #155724;
            margin-bottom: 10px;
        }

        .confirmation-content p {
            color: #155724;
            margin: 0;
        }

        .additional-info {
            margin-top: 40px;
        }

        .additional-info h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }

        .additional-info ul {
            padding-left: 20px;
        }

        .additional-info li {
            margin-bottom: 8px;
        }

        .additional-info a {
            color: #007bff;
            text-decoration: none;
        }

        .additional-info a:hover {
            text-decoration: underline;
        }
    </style>
</body>
</html>
